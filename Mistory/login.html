<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/Mistory/css/all.css">
    <link rel="stylesheet" href="/Mistory/css/nav.css">
    <link rel="stylesheet" href="/Mistory/css/dark-mode.css">
    <link rel="stylesheet" href="/Mistory/css/login.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
</head>
<body>

    <!-- 헤더 -->
    <header>
        <div class="header_top" style="height:30px; width: auto; background-color: #008156"></div>
        <div class="header_bottom" style="height:70px;">
            <a href="index.html" style="margin: 0;">
                <img src="/Mistory/img/logo.png" alt="" style="width:203px; height:auto">
            </a>
            <nav_menu>
                
            </nav_menu>
            <div class="icon_nav">
                <div id="toggleDarkMode"><i class="bi bi-moon"></i></div>
                <!-- <i class="bi bi-moon-fill"></i> -->
                <a href="login.html"><i class="bi bi-box-arrow-in-right"></i></a>
            </div>
        </div>
    </header>

    <div class="timer" id="timer">05:00</div>
    <script src="/Mistory/js/timer.js"></script>



    <div class="container">
        <div class="login">
            <div class="logoImg"><img src="img/logo.png"/></div>
            <p class="message">발견한 단어를 조합하여 <br/> 로그인 해주세요</p>
            <form action="http://43.203.128.248:3000/login" method="POST">
                <input type="text" value="MIRIM2024" placeholder="아이디" id="username" name="username"/>
                <input type="password" value="" placeholder="비밀번호" id="password" name="password"/>
                <button id="loginForm" class="loginBtn" type="submit">로그인</button>
            </form>
        </div>
    </div>


    <script src="/Mistory/js/dark-mood.js"></script>


    <script>

        document.addEventListener('DOMContentLoaded', function() {
            document.documentElement.classList.remove('no-js');
            checkLoginError();
        });

        function checkLoginError() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('fail') == 'true') {
                alert("비밀번호가 잘못되었습니다. 다시 시도해주세요.");
            }
        }

        document.getElementById("loginForm").addEventListener("submit", function(event) {
            event.preventDefault(); // 기본 폼 제출 동작 방지

            var formData = new FormData(this);

            fetch(this.action, {
                method: "POST",
                body: formData
            })
            .then(response => {
                // if (response.status === 401) {
                //     // 로그인 실패 시 URL에 fail 파라미터 추가
                //     window.location.href = "login.html?fail=true";
                //     throw new Error("Unauthorized");
                // }
                // return response.json();
            })
            .then(data => {

                const nickname = localStorage.getItem('nickname');
                console.log(nickname);

                // 걸린 시간 가져오기
                // 타이머 종료 및 걸린 시간 계산
                const now = new Date().getTime();
                const endTime = parseInt(localStorage.getItem('timerEndTime'), 10);
                const startTime = endTime - (5 * 60 * 1000);
                const elapsedTime = now - startTime;

                const elapsedMinutes = Math.floor((elapsedTime % (1000 * 60 * 60)) / (1000 * 60));
                const elapsedSeconds = Math.floor((elapsedTime % (1000 * 60)) / 1000);

                const time = `00:${String(elapsedMinutes).padStart(2, '0')}:${String(elapsedSeconds).padStart(2, '0')}`;
                console.log(time);

                fetch("http://43.203.128.248:3000/rank", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ nickname, time })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Parsed JSON data:', data);
                    if (data && Array.isArray(data)) {
                        
                    } else {
                        console.error('Invalid data format:', data);
                    }
                })
                .catch(error => console.error('Error fetching rank data:', error));
            })
            .catch(error => {
                // if (error.message !== "Unauthorized") {
                //     console.error("Error:", error);
                // }
            });
        });
    </script>

    <hr style="color:#BBBBBB; margin: 100px auto 0; width: 1320px;">

    <footer style="padding: 20px 0; background-color: none;">
        <div class="footer-content" style="max-width: 1320px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;">
            <img src="./img/footer_logo.png" alt="" style="width: 91px; height: 76px; margin-right: 20px;">
            <div class="footer-info" style="flex: 1; min-width: 250px; padding: 10px;">
                <div class="footer-top" style="display: flex; gap: 15px; margin-bottom: 10px; font-size: 13px;">
                    <h3 style="margin: 0;">개인정보보호방침</h3>|<h3 style="margin: 0;">학교정보공개</h3>|<h3 style="margin: 0;">배너모음</h3>
                </div>
                <p style="font-size: 14px; margin-bottom: 8px; margin-top: 0; color: #565555;">(08821) 서울시 관악구 호암로 546 (신림동)</p>
                <div class="footer-middle" style="display: flex; font-size: 14px; margin-bottom: 16px; color: #565555;">
                    <p style="margin: 0;"><strong>교무실</strong> 02-872-4071 (Fax 02-887-0856)</p><span style="margin-left: 5px; margin-right: 5px;">|</span><p style="margin: 0;"><strong>개발채용</strong> 070-5099-8306</p><span style="margin-left: 5px; margin-right: 5px;">|</span><p style="margin: 0;"><strong>디자인채용</strong> 070-5099-8315</p><span style="margin-left: 5px; margin-right: 5px;">|</span><p style="margin: 0;"><strong>취업지원부</strong> 02-888-8350(Fax 02-875-2092)</p><span style="margin-left: 5px; margin-right: 5px;">|</span><p style="margin: 0;"><strong>행정실</strong>  02-886-1812(Fax 02-878-2188)</p>
                </div>                
                <div class="footer-bottom" style="display: flex; gap: 15px; font-weight: bold; font-size: 15px; color: #565555;">
                    <p style="margin: 0;">546Hoam-ro,Gwank-gu, Seoul,08821 Korea</p>
                    <p style="margin: 0;">MIRIM MEISTER SCHOOL</p>
                </div>
            </div>
        </div>
    </footer>
    
</body>
</html>

<!-- // 기존 메시지와 힌트 버튼 제거
const existingMessageContainer = document.getElementById("message-container");
if (existingMessageContainer) {
    existingMessageContainer.remove();
}



window.location.href = 'ranking.html'; -->
